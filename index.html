`
<html dir="rtl">
<head>
    <meta charset="utf-8">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <style>
        .btn-orange, .bg-orange {
            background-color: #fd7e14;
            color: white;
        }

        .btn-yellow, .bg-yellow {
            background-color: #ffc107;
            color: white;
        }

        .btn-brown, .bg-brown {
            color: #fff;
            background-color: #653208;
        }

        .btn {
            font-size: 36px;
        }

        th {
            font-size: 36px;
            font-weight: bold;
        }

        td {
            font-size: 30px;
            padding: 20px 0 !important;
        }
    </style>
</head>
<body>
<div id="app">
    <div style="padding: 20px;">
        <div class="row">
            <div class="col-4">
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" @click="addAction('אוכל', 'primary')">אוכל</button>
                    <button class="btn btn-yellow" @click="addAction('החלפת פיפי', 'yellow')">החלפה פיפי</button>
                    <button class="btn btn-brown" @click="addAction('החלפת קקי', 'brown')">החלפה קקי</button>
                    <button class="btn btn-orange" @click="addAction('ויטמין D', 'orange')">ויטמין D</button>
                    <button class="btn btn-danger" @click="addAction('משחת בנפנפן', 'danger')">משחת בנפנפן</button>
                    <button class="btn btn-info text-white" @click="addAction('מקלחת', 'info')">מקלחת</button>
                </div>
            </div>
            <div class="col">
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col">תאריך ושעה</th>
                        <th scope="col">פעולה</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="record in records" :key="record.date" :class="`bg-${record.color}`" class="text-white">
                        <td>{{record.date}}</td>
                        <td>{{record.action}}</td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            db: null,
            records: []
        },
        mounted() {
            const self = this

            // Open our database; it is created if it doesn't already exist
            // (see onupgradeneeded below)
            let request = window.indexedDB.open('sahar_actions', 1);

            // onerror handler signifies that the database didn't open successfully
            request.onerror = function () {
                console.log('Database failed to open');
            };

            // onsuccess handler signifies that the database opened successfully
            request.onsuccess = function () {
                console.log('Database opened successfully');

                // Store the opened database object in the db variable. This is used a lot below
                self.db = request.result;

                // Run the displayData() function to display the notes already in the IDB
                let objectStore = self.db.transaction('sahar_actions').objectStore('sahar_actions');
                objectStore.openCursor().onsuccess = function (e) {
                    // Get a reference to the cursor
                    let cursor = e.target.result;

                    console.log(cursor)
                    // If there is still another data item to iterate through, keep running this code
                    if (cursor) {
                        const record = {
                            date: cursor.value.date,
                            action: cursor.value.action,
                            color: cursor.value.color,
                        }

                        self.records.unshift(record)

                        cursor.continue();
                    }
                };
            };

            // Setup the database tables if this has not already been done
            request.onupgradeneeded = function (e) {
                // Grab a reference to the opened database
                let db = e.target.result;

                // Create an objectStore to store our notes in (basically like a single table)
                // including a auto-incrementing key
                let objectStore = db.createObjectStore('sahar_actions', {keyPath: 'id', autoIncrement: true});

                // Define what data items the objectStore will contain
                objectStore.createIndex('date', 'date', {unique: false});
                objectStore.createIndex('action', 'action', {unique: false});
                objectStore.createIndex('color', 'color', {unique: false});
            }
        },
        methods: {
            addAction(action, color) {
                let newItem = {date: (new Date()).toLocaleString('he'), action, color};

                this.records.unshift(newItem)

                // open a read/write db transaction, ready for adding the data
                let transaction = this.db.transaction(['sahar_actions'], 'readwrite');

                // call an object store that's already been added to the database
                let objectStore = transaction.objectStore('sahar_actions');

                // Make a request to add our newItem object to the object store
                let request = objectStore.add(newItem);
                request.onsuccess = function () {
                    console.log('add success')
                };

                // Report on the success of the transaction completing, when everything is done
                transaction.oncomplete = function () {
                    console.log('Transaction completed: database modification finished.');
                };

                transaction.onerror = function () {
                    console.log('Transaction not opened due to error');
                };

            }
        }
    })
</script>
</body>
</html>
`
